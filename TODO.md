# To do

Here's what I'm currently working on:

### Features

- use duration rather than numTests?
- print progress while testing
- docs: contributing.md
  + https://github.com/rubyberlin/code-of-conduct?tab=readme-ov-file#readme ?
  + https://github.com/Gabriella439/grace/blob/main/CODE_OF_CONDUCT.md ?
- docs: document syntax?

```
  Spec ::= "component" Ident "where" Decl*
    Decl ::= OpDecl | TypeDecl

      -- XXX: Allow ModalType in response position? 
      -- semantics: unique response type will never get reused, and abstract
      -- response type will always get reused?
      OpDecl ::= ident ":" Method Path Body? ("->" Type)? 

        Method ::= "GET" | "POST"

        Path ::= ("/" PathSegment)* "/"?

          PathSegment = "{" ident ":" ModalType "}" | path

        Body ::= "{" ModalType "}"

      TypeDecl ::= "type" Ident "=" Type

  ModalType ::= Mode? Type

  Mode ::= "@" | "!"

  Type ::= BaseType | RecordDecl | Ident

  BaseType ::= "Unit" | "Bool" | "Int" | "String"

  RecordDecl ::= "{" Field ("," Field)* "}"  -- XXX: parser allows empty records?
    Field ::= ident ":" Type                 -- XXX: Modal type


  Ident ::= [A-Z][a-zA-Z0-9]*
  ident ::= [a-z][a-zA-Z0-9]*

  -- https://datatracker.ietf.org/doc/html/rfc3986#section-3.3
  path ::= pchar+
    pchar         = unreserved / pct-encoded / sub-delims / ":" / "@"

    pct-encoded   = "%" HEXDIG HEXDIG

    unreserved    = ALPHA / DIGIT / "-" / "." / "_" / "~"
    sub-delims    = "!" / "$" / "&" / "'" / "(" / ")"
                  / "*" / "+" / "," / ";" / "="
```
- Nice errors
  + Introduce FancyError datatype and display it in LibMain?
  + https://elm-lang.org/news/compiler-errors-for-humans
  + https://hackage.haskell.org/package/diagnose-2.5.1/docs/Error-Diagnose.html
  + https://medium.com/designing-atlassian/10-design-principles-for-delightful-clis-522f363bac87
  + https://github.com/charmbracelet/bubbletea
  + https://gleam.run/

- Packaging
  + move petstore to separate repo?
  + caching
    * https://github.com/moby/buildkit/issues/1673 
  + install script?
    * add windows and macos
    * confirm with user
    * update spexup itself? 
    * cache releases.json?
    * check what versions are locally installed already

      spexup [update] [spexup|spex] -- install latest version
    * spexup list -- lists available releases
      spexup install (spexup|spex) <version>

  + changelog generator (semantic commit messages)
  + commit hook for conventional commits?
- https://docs.github.com/en/get-started/writing-on-github/working-with-advanced-formatting/creating-and-highlighting-code-blocks#syntax-highlighting

### Bugs

- abstract types don't need to pass scope checking, but they fail during generation:

    ```
    component PetStore where
    
    addPet : POST /pet @Pet
    getPet : GET /pet/{petId : Int} -> Pet
    ```

    spex: genUserDefined: impossible, scope checker
    CallStack (from HasCallStack):
      error, called at src/Spex/Verifier/Generator.hs:198:20 in spex-0.0.0-inplace:Spex.Verifier.Generator

  They should be generated by reuse only...

- abstract types get generated, if there are not previous values to draw from.
  Fix by allowing generation to throw?
- unique types don't get checked
- normal types should sometimes generate/sometimes reuse

### Refactor

- remove ExceptT?
- remove use of String
- structured logs, returns json object with one error or one test result?
- use formatter?
